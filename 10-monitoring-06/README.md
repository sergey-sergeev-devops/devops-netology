## Домашнее задание к занятию 17 «Инцидент-менеджмент»

### Задание

#### Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.

#### Информацию о сбое можно изучить по ссылкам ниже:

* [краткое описание на русском языке](https://habr.com/ru/post/427301/);
* [развёрнутое описание на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

#### Решение:




| Краткое описание инцидента | На GitHub произошел инцидент, который привел к ухудшению качества обслуживания на 24 часа и 11 минут. Хотя этот инцидент не затронул некоторые части нашей платформы, были затронуты несколько внутренних систем, что привело к отображению устаревшей и противоречивой информации. В конечном счете, никакие пользовательские данные не были потеряны; однако ручное согласование данных в течение нескольких секунд записи в базу данных все еще продолжается. В большинстве случаев GitHub также не мог обслуживать события webhook или создавать и публиковать сайты GitHub Pages.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **События до инцидента**   | 21 октября в 22:52 UTC плановое техническое обслуживание по замене вышедшего из строя оптического оборудования 100G                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Причина инцидента**      | Плановое техническое обслуживание по замене вышедшего из строя оптического оборудования 100G привело к потере связи между сетевым хабом на Восточном побережье США и основным центром обработки данных на Восточном побережье США. Связь между этими точками была восстановлена за 43 секунды, но это кратковременное отключение вызвало цепочку событий, которые привели к                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Воздействие**            | Снижению качества обслуживания на 24 часа и 11 минут.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Обнаружение**            | Инцидент был обнаружен инженером. Привлечены ответственные за сервисы.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Реакция**                | Вызван координатор, переведен статус по сервису в красный, вызваны дополнительные инженеры по работе с базой данный MySQL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Восстановление**         | План состоял в том, чтобы выполнить восстановление из резервных копий, синхронизировать реплики на обоих сайтах, вернуться к стабильной топологии обслуживания и затем возобновить обработку заданий в очереди                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Таймлайн**               | **21 октября 2018 года, 22:52 UTC** <br>Во время разделения сети Orchestrator, который был активен в основном центре обработки данных, начал процесс отмены выбора руководства в соответствии с консенсусом Raft. Центры обработки данных на Западном побережье США и узлы Orchestrator общедоступного облака на Восточном побережье США смогли установить кворум и запустить сбой в работе кластеров, чтобы направлять записи в центр обработки данных на Западном побережье США. Orchestrator приступил к организации топологий кластера баз данных на Западном побережье США. Когда подключение было восстановлено, уровень приложений немедленно начал направлять трафик для записи на новые основные сайты на Западном побережье.<br>На серверах баз данных в центре обработки данных на Восточном побережье США в течение короткого периода времени хранились записи, которые не были реплицированы на объект на Западном побережье США. Поскольку кластеры баз данных в обоих центрах обработки данных теперь содержали записи, которых не было в другом центре обработки данных, мы не смогли безопасно перенести основную базу данных в центр обработки данных на Восточном побережье США.<br><br>**21 октября 2018 года, 22:54 UTC** <br>Системы внутреннего мониторинга начали генерировать предупреждения, указывающие на многочисленные сбои в работе систем. В это время несколько инженеров отвечали на запросы и работали над сортировкой входящих уведомлений. К 23:02 UTC инженеры группы быстрого реагирования определили, что топологии для многочисленных кластеров баз данных находятся в неожиданном состоянии. Запрос к API Orchestrator показал топологию репликации базы данных, которая включала только серверы из центра обработки данных на Западном побережье США.<br><br>**21 октября 2018 г., 23:07 UTC** <br>Команда, отвечающая на запрос, решила вручную заблокировать внутренний инструментарий для развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений. В 23:09 UTC команда, отвечающая на запрос, перевела сайт в желтый статус. Это действие автоматически привело к перерастанию ситуации в активный инцидент и отправке предупреждения координатору инцидента. В 23:11 UTC координатор инцидента подключился и через две минуты изменил статус решения на красный.<br><br>**21 октября 2018 года, 23:13 UTC** <br>На тот момент было понятно, что проблема затронула несколько кластеров баз данных. Были вызваны дополнительные инженеры из команды разработчиков баз данных GitHub. Они начали изучать текущее состояние, чтобы определить, какие действия необходимо предпринять, чтобы вручную настроить базу данных Восточного побережья США в качестве основной для каждого кластера и перестроить топологию репликации. Эта работа была сложной, поскольку к этому моменту кластер баз данных Западного побережья обрабатывал записи с нашего прикладного уровня почти 40 минут. Кроме того, в кластере Восточного побережья было несколько секунд записи, которые не были реплицированы на Западное побережье и препятствовали репликации новых записей обратно на Восточное побережье.<br>Защита конфиденциальности и целостности пользовательских данных является высшим приоритетом GitHub. Стремясь сохранить эти данные, мы решили, что более чем 30-минутная передача данных в центр обработки данных на Западном побережье США не позволила нам рассмотреть другие варианты, кроме переадресации, для обеспечения безопасности пользовательских данных. Однако приложения, работающие на Восточном побережье, которые зависят от записи информации в кластер MySQL на Западном побережье, в настоящее время не могут справиться с дополнительной задержкой, связанной с поездкой через всю страну в оба конца для большинства своих обращений к базе данных. Это решение привело бы к тому, что наш сервис стал бы недоступен для многих пользователей. Мы считаем, что длительное снижение качества обслуживания стоило того, чтобы обеспечить согласованность данных наших пользователей.<br><br>**21 октября 2018 года, 23:19 UTC** <br>После запроса состояния кластеров базы данных стало ясно, что нам нужно прекратить выполнение заданий, которые записывают метаданные о таких вещах, как pushs. Мы сделали явный выбор в пользу частичного ухудшения удобства использования сайта, приостановив доставку webhook и сборку страниц на GitHub, вместо того чтобы подвергать риску данные, которые мы уже получили от пользователей. Другими словами, наша стратегия заключалась в том, чтобы отдавать приоритет целостности данных, а не удобству использования сайта и времени на восстановление.<br><br>**22 октября 2018 года, 00:05 UTC** <br>Инженеры, участвующие в группе реагирования на инциденты, приступили к разработке плана устранения несоответствий данных и реализации наших процедур отработки отказа для MySQL. Наш план состоял в том, чтобы выполнить восстановление из резервных копий, синхронизировать реплики на обоих сайтах, вернуться к стабильной топологии обслуживания и затем возобновить обработку заданий в очереди. Мы обновили наш статус, чтобы проинформировать пользователей о том, что мы собираемся выполнить контролируемую отработку отказа внутренней системы хранения данных.<br>В то время как резервное копирование данных MySQL выполняется каждые четыре часа и сохраняется в течение многих лет, резервные копии хранятся удаленно в общедоступном облачном хранилище больших двоичных объектов. Из-за времени, необходимого для восстановления нескольких терабайт резервных данных, этот процесс занял несколько часов. Значительная часть времени была потрачена на перенос данных из службы удаленного резервного копирования. Процесс распаковки, определения контрольной суммы, подготовки и загрузки больших файлов резервных копий на недавно настроенные серверы MySQL занял большую часть времени. Эта процедура тестируется как минимум ежедневно, поэтому сроки восстановления были хорошо известны, однако до этого инцидента нам никогда не приходилось полностью перестраивать весь кластер из резервной копии, и вместо этого мы могли полагаться на другие стратегии, такие как отложенные реплики<br><br>**22 октября 2018 года, 00:41 UTC**<br>К этому времени был запущен процесс резервного копирования для всех затронутых кластеров MySQL, и инженеры отслеживали ход выполнения. Одновременно несколько команд инженеров изучали способы ускорения передачи и восстановления данных без дальнейшего ухудшения удобства использования сайта или риска повреждения данных.<br><br>**22 октября 2018 года, 06:51 UTC**<br>Несколько кластеров завершили восстановление из резервных копий в нашем центре обработки данных на Восточном побережье США и начали реплицировать новые данные с Западного побережья. Это привело к замедлению загрузки сайта для страниц, которым приходилось выполнять операцию записи по международной ссылке, но страницы, считываемые из этих кластеров баз данных, возвращали обновленные результаты, если запрос на чтение поступал на только что восстановленную реплику. Другие более крупные кластеры баз данных все еще восстанавливались.<br>Наши команды определили способы восстановления данных непосредственно с Западного побережья, чтобы преодолеть ограничения пропускной способности, вызванные загрузкой из удаленного хранилища, и все больше убеждались в том, что восстановление неизбежно, а время, оставшееся до создания работоспособной топологии репликации, зависит от того, сколько времени потребуется репликации, чтобы наверстать упущенное. Эта оценка была линейно интерполирована из имевшихся у нас данных телеметрии репликации, и страница состояния была обновлена, чтобы установить ожидаемое время восстановления в два часа в качестве расчетного времени восстановления.<br><br>**22 октября 2018 года, 07:46 UTC**<br>GitHub опубликовал сообщение в блоге, чтобы предоставить больше информации. Мы используем страницы GitHub для внутреннего использования, и все сборки были приостановлены несколькими часами ранее, поэтому публикация этого сообщения потребовала дополнительных усилий. Приносим извинения за задержку. Мы намеревались отправить это сообщение гораздо раньше и позаботимся о том, чтобы в будущем мы могли публиковать обновления с учетом этих ограничений.<br><br>**22 октября 2018 года, 11:12 UTC**<br>Все основные базы данных снова были установлены на Восточном побережье США. В результате сайт стал намного более отзывчивым, поскольку записи теперь направлялись на сервер базы данных, который был расположен в том же физическом центре обработки данных, что и наш уровень приложений. Несмотря на то, что это существенно повысило производительность, десятки реплик данных для чтения по-прежнему выполнялись с задержкой в несколько часов по сравнению с основной. Из-за этих задержек пользователи при взаимодействии с нашими сервисами видели противоречивые данные. Мы распределили нагрузку на чтение по большому пулу реплик для чтения, и каждый запрос к нашим службам имел хорошие шансы получить реплику для чтения, которая задерживалась на несколько часов.<br>На самом деле, время, необходимое для восстановления репликации, зависело от функции уменьшения мощности, а не от линейной траектории. Из-за увеличения нагрузки на кластеры наших баз данных, когда пользователи в Европе и США просыпались и начинали свой рабочий день, процесс восстановления занял больше времени, чем предполагалось изначально.<br><br>**22 октября 2018 г., 13:15 UTC**<br>К настоящему времени мы приближались к пиковой нагрузке на трафик на GitHub.com. Группа реагирования на инциденты обсудила дальнейшие действия. Было ясно, что задержки репликации увеличиваются, вместо того чтобы уменьшаться до согласованного состояния. Ранее в связи с инцидентом мы начали предоставлять дополнительные реплики для чтения MySQL в публичном облаке на Восточном побережье США. Как только они стали доступны, стало проще распределять объем запросов на чтение по большему количеству серверов. Снижение совокупного использования реплик для чтения позволило ускорить репликацию.<br><br>**22 октября 2018 г., 16:24 UTC**<br>Как только реплики были синхронизированы, мы выполнили переход на исходную топологию, чтобы устранить проблемы с задержкой и доступностью. В рамках осознанного решения о приоритетности обеспечения целостности данных в течение более короткого периода времени, связанного с инцидентами, мы сохранили статус обслуживания красным, приступив к обработке накопившихся данных.<br><br>**22 октября 2018 г., 16:45 UTC**<br>На этом этапе восстановления мы должны были сбалансировать возросшую нагрузку, связанную с невыполненной работой, что потенциально перегружало наших партнеров по экосистеме уведомлениями, и как можно быстрее восстановить 100%-ный уровень наших услуг. Было зарегистрировано более пяти миллионов перехватываемых событий и поставлено в очередь 80 тысяч построений страниц.<br><br>При обработке этих данных с поддержкой were мы обработали около 200 000 полезных запросов webhook, у которых истек внутренний TTL, и они были удалены. Обнаружив это, мы приостановили обработку и внесли изменения, чтобы увеличить этот TTL на некоторое время.<br><br>Чтобы избежать дальнейшего снижения надежности наших обновлений статуса, мы сохраняли статус "ухудшено" до тех пор, пока не завершили обработку всего объема накопившихся данных и не убедились, что наши сервисы вернулись к нормальному уровню производительности.<br><br>22 октября 2018 года, 23:03 UTC<br>Все ожидающие сборки веб-ссылок и страниц были обработаны, а целостность и правильная работа всех систем подтверждена. Статус сайта был обновлен до зеленого.<br> |
| **Последующие действия**   | **Устранение несоответствий в данных**<br>Во время нашего восстановления мы сохранили двоичные журналы MySQL, содержащие записи, сделанные на нашем основном сайте, которые не были реплицированы на наш сайт на Западном побережье из каждого затронутого кластера. Общее количество записей, которые не были реплицированы на Западном побережье, было относительно небольшим. Например, в одном из наших самых загруженных кластеров в проблемном окне было зафиксировано 954 записи. В настоящее время мы проводим анализ этих журналов и определяем, какие записи могут быть автоматически согласованы, а какие потребуют разъяснительной работы с пользователями. В этой работе задействовано несколько команд, и наш анализ уже выявил категорию записей, которые с тех пор были повторены пользователем и успешно сохранены. Как указано в этом анализе, нашей основной целью является сохранение целостности и точности данных, которые вы храните на GitHub.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
